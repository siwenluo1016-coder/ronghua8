<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å›¾ç‰‡å±•ç¤ºé¡µé¢</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background-color: #f0e6d2;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }
        
        .image-container {
            position: relative;
            width: 640px;
            height: 1030px;
            overflow: hidden;
        }
        
        #bg-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center;
            z-index: 1;
        }
        
        /* éŸ³ä¹å›¾æ ‡æ ·å¼ */
        #music-icon {
            position: absolute;
            top: 25px;
            right: 25px;
            width: 50px;
            height: auto;
            cursor: pointer;
            z-index: 10; /* ç¡®ä¿åœ¨æ‰€æœ‰å…ƒç´ æœ€ä¸Šå±‚ */
            transition: transform 0.2s ease;
            animation: fadeIn 2s ease forwards;
            animation-delay: 1s;
            opacity: 0;
        }
        
        #music-icon:hover {
            transform: scale(1.05);
        }
        
        /* æ·¡å…¥åŠ¨ç”» */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .show-image {
            position: absolute;
            z-index: 2;
            object-fit: contain;
            border-radius: 4px;
        }
        
        #kuang-img {
            top: 60%;
            left: 0%;
            width: 100%;
            height: 30%;
        }
        
        #hehua-img {
            top: 25%;
            left: 15%;
            width: 70%;
            height: 48%;
        }
        
        #next-img {
            top: 83%;
            left: 67%;
            width: 25%;
            height: 20%;
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        
        #next-img:hover {
            transform: scale(1.05);
        }
        
        #zi-img {
            top: 65%;
            left: 26%;
            width: 52%;
            height: 30%;
        }
        
        #touming-img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 3;
            object-fit: cover;
            display: none;
        }
        
        .overlay-image {
            position: absolute;
            z-index: 4;
            object-fit: contain;
            display: none;
        }
        
        #jingling-overlay {
            top: 5%;
            left: 27%;
            width: 40%;
            height: 45%;
        }
        
        #dankuang-overlay {
            top: 60%;
            left: 5%;
            width: 90%;
            height: 30%;
        }
        
        #baisezi-overlay {
            top: 43%;
            left: 19%;
            width: 60%;
            height: 25%;
        }
        
        #next-overlay {
            top: 85%;
            left: 67%;
            width: 25%;
            height: 15%;
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        
        #next-overlay:hover {
            transform: scale(1.05);
        }
        
        #text-input-container {
            position: absolute;
            top: 60%;
            left: 5%;
            width: 90%;
            height: 30%;
            z-index: 5;
            display: none;
        }
        
        #text-input {
            position: absolute;
            top: 40%;
            left: 10%;
            width: 80%;
            height: 60%;
            background: transparent;
            border: none;
            outline: none;
            font-size: 24px;
            font-family: 'LiSu', 'STKaiti', 'SimSun', serif;
            color: #5C4033;
            text-align: center;
            resize: none;
            padding: 10px;
            line-height: 1;
        }
        
        #text-input::placeholder {
            color: #999;
            font-size: 20px;
        }
    </style>
</head>
<body>
    <div class="image-container">
        <img id="bg-image" src="dabeijing.jpg" alt="å¤§èƒŒæ™¯å›¾">
        <!-- æ·»åŠ éŸ³ä¹å›¾æ ‡ -->
        <img id="music-icon" src="music1.png" alt="éŸ³ä¹å›¾æ ‡">
        <img id="kuang-img" class="show-image" src="kuang.png" alt="æ¡†å›¾ç‰‡">
        <img id="zi-img" class="show-image" src="zi.png" alt="å­—å›¾ç‰‡">
        <img id="hehua-img" class="show-image" src="hehua-hzh.png" alt="è·èŠ±å›¾ç‰‡">
        <img id="next-img" class="show-image" src="next.png" alt="ä¸‹ä¸€å¼ å›¾ç‰‡">
        
        <img id="touming-img" src="touming.png" alt="é€æ˜è¦†ç›–å›¾ç‰‡">
        
        <img id="jingling-overlay" class="overlay-image" src="jingling.png" alt="ç²¾çµå›¾ç‰‡">
        <img id="dankuang-overlay" class="overlay-image" src="dankuang.png" alt="å•æ¡†å›¾ç‰‡">
        <img id="baisezi-overlay" class="overlay-image" src="baisezi.png" alt="ç™½å­—å›¾ç‰‡">
        <img id="next-overlay" class="overlay-image" src="next.png" alt="ä¸‹ä¸€æ­¥å›¾ç‰‡">
        
        <div id="text-input-container">
            <textarea id="text-input" placeholder="åœ¨è¿™é‡Œè¾“å…¥æ‚¨çš„æ–‡å­—..."></textarea>
        </div>
    </div>

    <script>
        // ====================== æ ¸å¿ƒï¼šéŸ³ä¹æ§åˆ¶é€»è¾‘ ======================
        // 1. åˆ›å»ºéŸ³é¢‘å¯¹è±¡ï¼ˆå¤ç”¨ç¼“å­˜ï¼‰
        let audio = new Audio('music.mp3');
        audio.loop = true;
        audio.volume = 0.8;
        
        // è¯»å–å‰ä¸€ä¸ªé¡µé¢ä¼ é€’çš„çŠ¶æ€ï¼ˆæ— åˆ™é»˜è®¤æš‚åœï¼‰
        let audioState = JSON.parse(localStorage.getItem('audioState') || '{"isPlaying":false,"icon":"music1.png","currentTime":0}');
        
        // 2. DOMåŠ è½½å®Œæˆç«‹å³ç»­æ’­
        document.addEventListener('DOMContentLoaded', function() {
            // æ¢å¤ä»å‰ä¸€ä¸ªé¡µé¢å¸¦æ¥çš„è¿›åº¦
            if (audioState.currentTime) {
                audio.currentTime = audioState.currentTime;
            }
            // è‡ªåŠ¨ç»­æ’­ï¼ˆå‡å°‘åœé¡¿ï¼‰
            if (audioState.isPlaying) {
                setTimeout(() => {
                    audio.play().catch(err => {
                        // æµè§ˆå™¨ç¦æ­¢è‡ªåŠ¨æ’­æ”¾æ—¶ï¼Œç‚¹å‡»åç›´æ¥åˆ‡æ¢
                        console.log('éœ€ç‚¹å‡»å›¾æ ‡æ’­æ”¾éŸ³ä¹');
                    });
                }, 0);
            }
            // åŒæ­¥å›¾æ ‡ï¼ˆå’Œå‰ä¸€ä¸ªé¡µé¢ä¿æŒä¸€è‡´ï¼‰
            const musicIcon = document.getElementById('music-icon');
            if (musicIcon) {
                musicIcon.src = audioState.icon;
                musicIcon.style.animation = 'fadeIn 2s ease forwards';
                musicIcon.style.animationDelay = '1s';
            }
        });

        // 3. ç‚¹å‡»ä¸€æ¬¡å³åˆ‡æ¢å›¾æ ‡+æ§åˆ¶éŸ³ä¹
        const musicIcon = document.getElementById('music-icon');
        if (musicIcon) {
            musicIcon.addEventListener('click', function(e) {
                e.stopPropagation();
                
                if (audio.paused) {
                    // æš‚åœçŠ¶æ€ â†’ æ’­æ”¾ + åˆ‡æ¢ä¸ºmusic.png
                    audio.play();
                    this.src = 'music.png';
                    audioState.isPlaying = true;
                    console.log('æ’­æ”¾éŸ³ä¹ï¼Œå›¾æ ‡åˆ‡æ¢ä¸ºmusic.pngï¼Œè¿›åº¦ï¼š', audio.currentTime.toFixed(2), 'ç§’');
                } else {
                    // æ’­æ”¾çŠ¶æ€ â†’ æš‚åœ + åˆ‡æ¢ä¸ºmusic1.png
                    audio.pause();
                    this.src = 'music1.png';
                    audioState.isPlaying = false;
                    console.log('æš‚åœéŸ³ä¹ï¼Œå›¾æ ‡åˆ‡æ¢ä¸ºmusic1.pngï¼Œè¿›åº¦ï¼š', audio.currentTime.toFixed(2), 'ç§’');
                }
                
                // ä¿å­˜æœ€æ–°çŠ¶æ€ï¼ˆä¾›åç»­è·³è½¬/è¿”å›ä½¿ç”¨ï¼‰
                audioState.currentTime = audio.currentTime;
                audioState.icon = this.src;
                localStorage.setItem('audioState', JSON.stringify(audioState));
            });
        }

        // ========== é¡µé¢åŸæœ‰åŠŸèƒ½ä»£ç  ==========
        document.addEventListener('DOMContentLoaded', function() {
            // ========== ç¬¬ä¸€æ­¥ï¼šä»URLå‚æ•°è¯»å–å›¾ç‰‡å’ŒåŒºåŸŸä¿¡æ¯ ==========
            const urlParams = new URLSearchParams(window.location.search);
            const flowerImage = urlParams.get('flower') || "zfz1.jpg"; // ä»index6ä¼ æ¥çš„çƒ«èŠ±å›¾ç‰‡
            const areaType = parseInt(urlParams.get('area')) || 1; // åŒºåŸŸç±»å‹ï¼š1=æ¢…èŠ±ï¼Œ2=è·èŠ±
            
            console.log('ğŸŒº æ¥æ”¶åˆ°çš„URLå‚æ•°:', { 
                flowerImage: flowerImage, 
                areaType: areaType 
            });
            
            // ========== ç¬¬äºŒæ­¥ï¼šå›¾ç‰‡æ˜ å°„é…ç½®ï¼ˆä¿®æ”¹ç‰ˆï¼‰ ==========
            const flowerMapping = {
                // area=2: è·èŠ±æ˜ å°„ï¼ˆå¯¹åº”åŒºåŸŸ2ï¼‰
                "2": {
                    "fhf1.jpg": "hehua-fhf.png",
                    "fzf1.jpg": "hehua-fzf.png",
                    "hfh1.jpg": "hehua-hfh.png",
                    "hzh1.jpg": "hehua-hzh.png",
                    "zfz1.jpg": "hehua-zfz.png",
                    "zhz1.jpg": "hehua-zhz.png"
                },
                // area=3: æ¢…èŠ±æ˜ å°„ï¼ˆå¯¹åº”åŒºåŸŸ3ï¼‰
                "3": {
                    "fhf1.jpg": "meihua-fhf.png",
                    "fzf1.jpg": "meihua-fzf.png", 
                    "hfh1.jpg": "meihua-hfh.png",
                    "hzh1.jpg": "meihua-hzh.png",
                    "zfz1.jpg": "meihua-zfz.png",
                    "zhz1.jpg": "meihua-zhz.png"
                }
            };
            
            // ========== ç¬¬ä¸‰æ­¥ï¼šæ ¹æ®åŒºåŸŸç±»å‹å’Œå›¾ç‰‡åç§°è·å–å¯¹åº”çš„æ˜¾ç¤ºå›¾ç‰‡ ==========
            const areaKey = areaType.toString(); // è½¬æ¢ä¸ºå­—ç¬¦ä¸²
            const displayImage = flowerMapping[areaKey]?.[flowerImage] || 
                (areaType === 2 ? "hehua-zfz.png" : "meihua-zfz.png");
            
            console.log('ğŸ–¼ï¸ å°†è¦æ˜¾ç¤ºçš„å›¾ç‰‡:', displayImage, 'åŒºåŸŸç±»å‹:', areaKey);
            
            // ========== ç¬¬å››æ­¥ï¼šæ›´æ–°é¡µé¢ä¸Šçš„è·èŠ±å›¾ç‰‡ ==========
            const originalFlowerImg = document.getElementById('hehua-img');
            if (originalFlowerImg) {
                originalFlowerImg.src = displayImage;
                console.log('âœ… å·²æ›´æ–°è·èŠ±å›¾ç‰‡ä¸º:', displayImage);
            }
            
            // ========== ç¬¬äº”æ­¥ï¼šè·å–å…¶ä»–å…ƒç´ ï¼ˆåŸæœ‰ä»£ç ï¼‰ ==========
            const nextBtn = document.getElementById('next-img');
            const toumingImg = document.getElementById('touming-img');
            const jinglingOverlay = document.getElementById('jingling-overlay');
            const dankuangOverlay = document.getElementById('dankuang-overlay');
            const baiseziOverlay = document.getElementById('baisezi-overlay');
            const nextOverlay = document.getElementById('next-overlay');
            const textInputContainer = document.getElementById('text-input-container');
            const textInput = document.getElementById('text-input');
            
            // è·å–å½“å‰é¡µé¢æ˜¾ç¤ºçš„è·èŠ±å›¾ç‰‡çš„å®Œæ•´è·¯å¾„
            let flowerImageSrc = originalFlowerImg.src;
            
            // ä¿å­˜åŸå§‹çš„flowerImageä¿¡æ¯ï¼Œç”¨äºä¼ é€’ç»™index9.html
            const originalFlowerData = {
                flowerImage: flowerImage, // åŸå§‹çƒ«èŠ±å›¾ç‰‡åï¼ˆå¦‚ fhf1.jpgï¼‰
                displayImage: displayImage, // æ˜¾ç¤ºçš„æ¢…èŠ±/è·èŠ±å›¾ç‰‡å
                areaType: areaType // åŒºåŸŸç±»å‹
            };
            
            // ========== ç¬¬å…­æ­¥ï¼šä¸‹ä¸€æ­¥æŒ‰é’®ç‚¹å‡»äº‹ä»¶ ==========
            nextBtn.addEventListener('click', function() {
                // åªæ˜¾ç¤ºé€æ˜é¡µå’Œè¾“å…¥ç›¸å…³å…ƒç´ 
                toumingImg.style.display = 'block';
                jinglingOverlay.style.display = 'block';
                dankuangOverlay.style.display = 'block';
                baiseziOverlay.style.display = 'block';
                nextOverlay.style.display = 'block';
                textInputContainer.style.display = 'block';
                textInput.focus();
            });
            
            // ========== ç¬¬ä¸ƒæ­¥ï¼šè¦†ç›–å±‚ä¸‹ä¸€æ­¥æŒ‰é’®ç‚¹å‡»äº‹ä»¶ï¼ˆä¿®æ”¹ç‰ˆï¼‰ ==========
            nextOverlay.addEventListener('click', function() {
                const userInputText = textInput.value.trim();
                
                if (userInputText) {
                    // ä¿å­˜ç”¨æˆ·è¾“å…¥çš„æ–‡å­—
                    localStorage.setItem('userInputText', userInputText);
                    
                    // ä¿å­˜å›¾ç‰‡çš„å®Œæ•´ä¿¡æ¯ï¼ˆä¸ä»…ä»…æ˜¯srcè·¯å¾„ï¼‰
                    localStorage.setItem('flowerImageData', JSON.stringify(originalFlowerData));
                    
                    // å¦‚æœéœ€è¦ï¼Œä¹Ÿå¯ä»¥ä¿å­˜å®Œæ•´çš„å›¾ç‰‡è·¯å¾„
                    localStorage.setItem('flowerImageSrc', flowerImageSrc);
                    
                    // ä¿å­˜éŸ³ä¹çŠ¶æ€
                    if (musicIcon) {
                        audioState.currentTime = audio.currentTime;
                        audioState.isPlaying = !audio.paused;
                        audioState.icon = musicIcon.src;
                        localStorage.setItem('audioState', JSON.stringify(audioState));
                    }
                    
                    console.log('ğŸ’¾ ä¿å­˜æ•°æ®åˆ°localStorage:', {
                        userInputText: userInputText,
                        flowerImageData: originalFlowerData,
                        flowerImageSrc: flowerImageSrc,
                        audioState: audioState
                    });
                    
                    // è·³è½¬åˆ°ç›®æ ‡é¡µé¢
                    window.location.href = '/ç»’èŠ±1/flower-9/index9.html';
                } else {
                    alert('è¯·åœ¨æ–‡æœ¬æ¡†ä¸­è¾“å…¥ä¸€äº›æ–‡å­—');
                    textInput.focus();
                }
            });
            
            // ========== ç¬¬å…«æ­¥ï¼šè¾…åŠ©å‡½æ•°ï¼ˆåŸæœ‰ä»£ç ï¼‰ ==========
            function hideAllOverlays() {
                toumingImg.style.display = 'none';
                jinglingOverlay.style.display = 'none';
                dankuangOverlay.style.display = 'none';
                baiseziOverlay.style.display = 'none';
                nextOverlay.style.display = 'none';
                textInputContainer.style.display = 'none';
            }
            
            toumingImg.addEventListener('click', function(e) {
                e.stopPropagation();
                hideAllOverlays();
            });
            
            dankuangOverlay.addEventListener('click', function() {
                textInput.focus();
            });
            
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    hideAllOverlays();
                }
            });
            
            // ========== ç¬¬ä¹æ­¥ï¼šé¡µé¢åŠ è½½åæ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯ ==========
            console.log('âœ… index8.html åˆå§‹åŒ–å®Œæˆ');
            console.log('ğŸ“‹ å½“å‰å›¾ç‰‡é…ç½®:', originalFlowerData);
        });
    </script>
</body>
</html>